@startuml

participant cerebrum
participant control_system
participant image_system
participant sound_system
actor customer


cerebrum -> control_system: start_localization
control_system --> cerebrum: 完了フラグ

group Start ( judge position )
	cerebrum -> control_system: get_distance
	control_system --> sound_system: speak right|left
	sound_system -> cerebrum: finish judge_position
end

group Loop (競技遂行のための繰り返し 2回)

	group Calling ( detect order )
        cerebrum -> sound_system: 注文者の方向を音声から判定開始
        customer -> sound_system: 注文者は'hey ducker, take the order'と発話
		sound_system --> control_system: turn angular
		control_system -> image_system: 手を振っているお客を認識し、Realsenseより深度データを取得する
		image_system -> control_system: お客様の位置の深度データを送信
		control_system -> control_system: 地図に注文者の場所を記載
        control_system --> cerebrum: 完了フラグの受信
    end
    
    group Delivering phas ( 注文者の場所への移動 )
        cerebrum -> control_system: 注文者の手前に移動
        control_system --> cerebrum: 完了フラグの受信
    end
    
	
    group Check oder (注文するかの確認)
		cerebrum -> sound_system: 注文をするか発話
		customer -> sound_system: Yes, Noを聞きとる
		sound_system --> cerebrum: Yes, No データを受け取り
    end


	group get order ( If 注文をする : Yes )
        cerebrum -> sound_system: オーダーするように発話する
        customer -> sound_system: 注文者は注文を行う
        sound_system -> cerebrum: 注文の内容を受信 データ構造はJSON
    end
    
    group return counter
        cerebrum -> control_system: カウンターへ地図をもとに戻る
		control_system -> sound_system: 品物を置くように発話
		sound_system -> cerebrum: 終了フラグ
    end
    
    group deliver object (現状はこちらを最優先)
        cerebrum -> control_system: 地図をもとに注文者の場所へ移動
        control_system --> cerebrum: 完了フラグの受信
    end

	group Check oder (受け取ったかの確認)
        cerebrum -> sound_system: 品物を受け取ったかの確認
        customer -> sound_system: Yes, Noを聞きとる
        sound_system --> cerebrum: Yes, No データを受け取り
    end

	group return counter
        cerebrum -> control_system: カウンターへ地図をもとに戻る
		control_system -> cerebrum: 終了フラグ
	end
    
end

cerebrum -> control_system: 自己位置推定の停止
control_system --> cerebrum: 完了フラグの受信

@enduml
